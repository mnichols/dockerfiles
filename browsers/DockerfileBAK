FROM ansible/ubuntu14.04-ansible
MAINTAINER Mike Nichols <nichols.mike.s@gmail.com>

ENV LC_ALL C
ENV DEBIAN_FRONTEND noninteractive
ENV DEBCONF_NONINTERACTIVE_SEEN true

RUN echo "deb http://archive.ubuntu.com/ubuntu trusty main universe" > /etc/apt/sources.list
RUN echo "deb http://security.ubuntu.com/ubuntu trusty-security main universe" >> /etc/apt/sources.list
RUN echo "deb http://us.archive.ubuntu.com/ubuntu/ trusty-updates main universe" >> /etc/apt/sources.list

RUN apt-get -y update
RUN apt-get install -y -q software-properties-common curl unzip wget x11vnc xvfb openjdk-7-jre-headless

# Nave/Node
RUN curl https://raw.githubusercontent.com/isaacs/nave/master/nave.sh > nave.sh
RUN chmod +x nave.sh
RUN ./nave.sh usemain stable
RUN npm install -g selenium-standalone

# fix https://code.google.com/p/chromium/issues/detail?id=318548
RUN mkdir -p /usr/share/desktop-directories

# Firefox
RUN apt-get -y update
RUN apt-get install -y firefox

# Chrome
# RUN wget -q -O - https://dl-ssl.google.com/linux/linux_signing_key.pub | apt-key add -
# RUN echo "deb http://dl.google.com/linux/chrome/deb/ stable main" > /etc/apt/sources.list.d/google.list
# RUN apt-get -y update
# RUN apt-get install -y google-chrome-stable



ADD . ./playbooks
RUN ansible-playbook ./playbooks/site.yml

# Try to shrink
RUN apt-get clean
RUN apt-get autoremove -y

# RUN apt-get -y update
RUN apt-get install -y -q xfonts-100dpi xfonts-75dpi xfonts-scalable xfonts-cyrillic
RUN useradd -d /home/chromeuser -m chromeuser
RUN mkdir -p /home/chromeuser/chrome
RUN chown chromeuser /home/chromeuser/chrome
RUN chgrp chromeuser /home/chromeuser/chrome
ADD ./scripts/ /home/root/scripts
EXPOSE 4444 5999
# ENTRYPOINT ["sh", "/home/root/scripts/simple.sh"]
# ENTRYPOINT ["/usr/bin/xvfb-run"]
# ENTRYPOINT ["/bin/bash"]
